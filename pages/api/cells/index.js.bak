import { supabase } from '../../../lib/supabase'


export default async function handler(req, res) {
if (req.method !== 'PUT' && req.method !== 'POST') {
res.setHeader('Allow', ['PUT', 'POST'])
return res.status(405).end(`Method ${req.method} Not Allowed`)
}


const { record_id, field_id, value } = req.body


// Upsert the cell value (unique(record_id, field_id) exists)
const { data, error } = await supabase
.from('record_values')
.upsert([{ record_id, field_id, value }], { onConflict: 'record_id,field_id' })
.select()


if (error) return res.status(500).json({ error: error.message })
return res.status(200).json(data[0])
}